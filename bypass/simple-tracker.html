<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Simple Tracker</title>
</head>
<body>
<script>
// ÐŸÑ€Ð¾ÑÑ‚Ð¾Ð¹ Ñ‚Ñ€ÐµÐºÐµÑ€ Ð±ÐµÐ· Ñ‚ÐµÑÑ‚Ð¾Ð² - ÑÑ€Ð°Ð·Ñƒ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÐ¼ Ð´Ð°Ð½Ð½Ñ‹Ðµ
(function() {
    console.log('ðŸš€ Simple tracker iframe loaded');
    
    // ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ð¸Ð· URL
    const params = new URLSearchParams(window.location.search);
    const trackingData = {
        affiliate_code: params.get('affiliate_code'),
        event: params.get('event') || 'page_view',
        url: params.get('url'),
        referrer: params.get('referrer'),
        session_id: params.get('session_id'),
        timestamp: params.get('timestamp') || Date.now(),
        user_agent: params.get('user_agent') || navigator.userAgent
    };
    
    console.log('ðŸ“Š Tracking data:', trackingData);
    
    if (!trackingData.affiliate_code) {
        console.log('âŒ No affiliate code provided');
        return;
    }
    
    // ÐŸÑ€Ð¾Ð±ÑƒÐµÐ¼ Ñ€Ð°Ð·Ð½Ñ‹Ðµ Ð¼ÐµÑ‚Ð¾Ð´Ñ‹ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¸
    let success = false;
    
    // ÐœÐµÑ‚Ð¾Ð´ 1: POST Ñ„Ð¾Ñ€Ð¼Ð°
    function sendViaForm() {
        console.log('ðŸ“ Trying POST form...');
        
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = 'https://affiliate.33rd.pro/api/tracker.php';
        form.style.display = 'none';
        
        Object.entries(trackingData).forEach(([key, value]) => {
            if (value) {
                const input = document.createElement('input');
                input.name = key;
                input.value = String(value);
                form.appendChild(input);
            }
        });
        
        document.body.appendChild(form);
        form.submit();
        console.log('âœ… POST form submitted');
        
        setTimeout(() => {
            if (form.parentNode) form.parentNode.removeChild(form);
        }, 2000);
    }
    
    // ÐœÐµÑ‚Ð¾Ð´ 2: Image pixel
    function sendViaImage() {
        console.log('ðŸ–¼ï¸ Trying image pixel...');
        
        const url = new URL('https://affiliate.33rd.pro/api/tracker.php');
        Object.entries(trackingData).forEach(([key, value]) => {
            if (value) url.searchParams.append(key, String(value));
        });
        
        const img = new Image();
        img.onload = () => console.log('âœ… Image pixel loaded successfully');
        img.onerror = () => console.log('âŒ Image pixel failed');
        img.src = url.toString();
    }
    
    // ÐœÐµÑ‚Ð¾Ð´ 3: Fetch
    function sendViaFetch() {
        console.log('ðŸŒ Trying fetch...');
        
        const url = new URL('https://affiliate.33rd.pro/api/tracker.php');
        Object.entries(trackingData).forEach(([key, value]) => {
            if (value) url.searchParams.append(key, String(value));
        });
        
        fetch(url.toString(), {
            method: 'GET',
            mode: 'no-cors'
        }).then(() => {
            console.log('âœ… Fetch request sent');
        }).catch(e => {
            console.log('âŒ Fetch failed:', e.message);
        });
    }
    
    // ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÐ¼ Ð²ÑÐµÐ¼Ð¸ Ð¼ÐµÑ‚Ð¾Ð´Ð°Ð¼Ð¸ ÑÑ€Ð°Ð·Ñƒ
    sendViaForm();
    
    setTimeout(() => {
        sendViaImage();
    }, 500);
    
    setTimeout(() => {
        sendViaFetch();
    }, 1000);
    
    // Ð£Ð²ÐµÐ´Ð¾Ð¼Ð»ÑÐµÐ¼ Ñ€Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÑÐºÐ¾Ðµ Ð¾ÐºÐ½Ð¾
    setTimeout(() => {
        if (window.parent) {
            window.parent.postMessage({
                type: 'simple_tracking_sent',
                data: trackingData
            }, '*');
        }
        console.log('ðŸ“¡ Notified parent window');
    }, 1500);
    
})();
</script>
</body>
</html>