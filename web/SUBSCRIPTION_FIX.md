# SDK v1.0.6 - Умное отслеживание подписок

## Проблема
Приложения отправляют событие `subscription_check` с `check_type: "started"` при запуске, которое всегда содержит `is_premium: false`, даже если пользователь только что оформил подписку.

## Решение
SDK теперь запоминает последнюю покупку и автоматически корректирует статус подписки в течение 5 минут после покупки.

## Как это работает:

1. **При покупке подписки** SDK сохраняет:
   - Время покупки
   - ID продукта
   - Дату истечения подписки
   - Все детали покупки

2. **При проверке подписки** (check_type: "started"):
   - Если прошло менее 5 минут с момента покупки
   - SDK автоматически устанавливает `is_premium: true`
   - Добавляет флаг `corrected_from_purchase: true`
   - Сохраняет оригинальное значение в `original_is_premium`

3. **Персистентность**:
   - Данные сохраняются в localStorage
   - Восстанавливаются при перезапуске приложения

## Пример работы:

```javascript
// Приложение совершает покупку
console.log("Purchase completed", {
  product_id: "monthly_sub",
  expires_date_ms: "1752611322100"
});
// SDK запоминает эти данные

// Приложение перезапускается и проверяет подписку
console.log("SUBSCRIPTION CHECK STARTED", {
  is_premium: false // неверное значение
});

// SDK автоматически корректирует:
// Отправляется событие с is_premium: true
```

## Результат:
- Корректное отслеживание подписок без изменений в приложении
- Работает "из коробки" для всех клиентов
- Решает проблему с неверным статусом после покупки